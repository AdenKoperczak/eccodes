
set suite grib_api


suite $suite

      clock hybrid
                 
	set USER max

      set SMSHOME              /home/ma/max/suites/$suite

      set ARCHITECTURE         'linux itanium cluster hpia64 rs6000 ibm_power4 open_solaris sun4'
#      set MACHINES_HPIA64      'bilbo faramir boromir denethor belegorn'
      set MACHINES_HPIA64      'bilbo'
      set MACHINES_LINUX       'suse91 suse101'
      set MACHINES_ITANIUM     'itanium'
      set MACHINES_RS6000      'ecgate'
      set MACHINES_SGI           ""
      set MACHINES_ALPHA         ""
      set MACHINES_SUN4         'solar'
      set MACHINES_OPEN_SOLARIS 'borg2'
      set MACHINES_IBM_POWER4   'hpcd hpce'
      set MACHINES_CLUSTER      'bee01'


      edit RELEASE             0.8.5
      edit CURRENT             0.8.5

	  edit FLAGS32             ""
	  edit FLAGS64             ""
	  edit ENABLE32            ""
	  edit ENABLE64            ""
	  edit CC                  ""

	  edit BOTH                ""

	  edit AMODE               32

      edit SMSHOME             $SMSHOME
	  edit LOGDIR              $SMSHOME

      edit DESTINATION         /usr/local/lib/metaps/lib
      edit DESTINATION64       /usr/local/lib64/metaps/lib
      edit BIN_DIR             /usr/local/lib/metaps/bin
      edit BIN_DIR64           /usr/local/lib64/metaps/bin
                            
      edit SMSINCLUDE          $SMSHOME/include
      edit SMSFILES            $SMSHOME/smsfiles

      edit DATA_DIR            $SMSHOME/data
      edit SRC_DIR             $SMSHOME/src

	  edit TOOLS               'grib_gen grib_ls grib_dump grib_gen'

# Perforce setting
	  set  P4_HOST             suse91
      set  P4_LOCAL           `/usr/local/lib/metaps/bin/datasvc_perforce_dir $P4_HOST`

	  edit P4_HOST             $P4_HOST
	  edit P4_LOCAL            $P4_LOCAL
#                             
      edit USER                $USER
      edit QSUB_TIME           50
      edit QSUB_MEMORY         200Mb
      edit QUEUE               metapps
                              
define hostmachine {
       edit HOST $1
       edit SMSCMD  "/home/ma/emos/bin/smssubmit %USER% %HOST% %SMSJOB%"
       edit SMSKILL "/home/ma/emos/bin/smskill %USER% %HOST% %SMSJOB%"
}

		set LIBRARY $suite
       edit LIBRARY $LIBRARY

	   family admin 
		   task createTar
			label createTar -
			   hostmachine $P4_HOST
	   endfamily


# Rest of the platforms
	  loop PLATFORM ($ARCHITECTURE) do
		family $PLATFORM
			 edit PLATFORM  $PLATFORM
			 case PLATFORM
				 in (hpia64) do
					set  MACHINES "$MACHINES_HPIA64"
					set  ADDRESS   '64'
					edit MAIN_ADDRESS   64
#	                edit ENABLE64  "--without-perl"
#	                edit ENABLE64  "--with-perl=/usr/bin/perl"
	                edit CC        "CC=cc"
				   endin
				 in (itanium) do
					set  MACHINES "$MACHINES_ITANIUM"
					set  ADDRESS   64
					edit MAIN_ADDRESS   64
	                edit ENABLE64  "--without-perl"
				   endin
				 in (linux) do
					set  MACHINES "$MACHINES_LINUX"
					set  ADDRESS   '32'
					edit MAIN_ADDRESS   32
				   endin
				 in (cluster) do
					set  MACHINES "$MACHINES_CLUSTER"
					set  ADDRESS   '32 64'
					edit MAIN_ADDRESS   32
	                edit ENABLE32  "--enable-32-bits-addressing-mode --without-perl"
	                edit ENABLE64  "--without-perl"
	                edit BOTH      "yes"
				   endin
				 in (rs6000) do
					set  MACHINES "$MACHINES_RS6000"
					set  ADDRESS   '32'
					edit MAIN_ADDRESS   32
	                edit CC        "CC=cc"
				   endin
				 in (sgimips) do
					set  MACHINES "$MACHINES_SGI"
					set  ADDRESS   '32'
					edit MAIN_ADDRESS   32
				   endin
				 in (decalpha) do
					set  MACHINES "$MACHINES_ALPHA"
					set  ADDRESS   '32'
					edit MAIN_ADDRESS   32
				   endin
				 in (sun4) do
					set  MACHINES "$MACHINES_SUN4"
					set  ADDRESS   '32'
					edit MAIN_ADDRESS   32
				   endin
				 in (open_solaris) do
					set  MACHINES "$MACHINES_OPEN_SOLARIS"
					set  ADDRESS   '64'
					edit MAIN_ADDRESS   64
	                edit ENABLE64  "--without-perl"
	                edit CC        "CC=/opt/SUNWspro/bin/cc"
#	                edit CC        "CC=/opt/sfw/gcc-3/bin/gcc"
				   endin
				 in (ibm_power4) do
					set  MACHINES "$MACHINES_IBM_POWER4"
					set  ADDRESS   '32 64'
					edit MAIN_ADDRESS   64
	                edit ENABLE32  "--enable-32-bits-addressing-mode"
	                edit ENABLE64  "--without-perl"
                    edit QUEUE ns
                    edit QUEUE_EPILOG ns
                    edit USER_PRIORITY 100
                    edit QSUB_MEMORY 160Mb
                    edit QSUB_TIME 100
                    edit LOGDIR /home/ma/$USER/logfiles
				   endin
			  endcase


		loop HOST ($MACHINES) do
		  family $HOST
             set  TMPBASE `/usr/local/lib/metaps/bin/datasvc_perforce_dir $HOST | sed 's/p4/build/g' `
             edit TMPBASE $TMPBASE
			 edit HOST $HOST
			 hostmachine $HOST
			     task setup
				   trigger /$LIBRARY/admin/createTar == complete
			       label setup -
         loop AMODE ($ADDRESS) do
           family address$AMODE
             edit AMODE $AMODE
			     task configure
				   trigger ../setup == complete
				   label configure -
			     task buildLibrary
				   trigger ./configure == complete
				   label buildLibrary -
#			     task checking
#				   trigger ./buildLibrary == complete
#				   label checking -
			     task installLibrary
				   defstatus suspended
#				   trigger ./checking == complete
				   trigger ./buildLibrary == complete
				   label install -
# end family address
	   	   endfamily
	   	 endloop
				task installDefinitions
				  defstatus suspended
				  trigger ./address$AMODE  == complete
# end family machines
		  endfamily
		endloop
# end family platform
	  endfamily
	endloop

# end of suite
endsuite
