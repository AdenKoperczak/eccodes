#
# (C) Copyright 2005- ECMWF.
#
# This software is licensed under the terms of the Apache Licence Version 2.0
# which can be obtained at http://www.apache.org/licenses/LICENSE-2.0.
#
# In applying this licence, ECMWF does not waive the privileges and immunities
# granted to it by virtue of its status as an intergovernmental organisation
# nor does it submit to any jurisdiction.
#
list( APPEND eccodes_src_files
    grib_api.h
    eccodes.h
    action.cpp
    action_class_alias.cpp
    action_class_gen.cpp
    action_class_if.cpp
    action_class_switch.cpp
    grib_accessor_class_g1fcperiod.cpp
    grib_accessor_class_g1end_of_interval_monthly.cpp
    grib_accessor_class_mars_param.cpp
    action_class_section.cpp
    action_class_list.cpp
    action_class_while.cpp
    action_class_put.cpp
    action_class_meta.cpp
    action_class_remove.cpp
    action_class_rename.cpp
    action_class_assert.cpp
    action_class_template.cpp
    action_class_trigger.cpp
    action_class_when.cpp
    action_class_concept.cpp
    action_class_hash_array.cpp
    action_class_set.cpp
    action_class_set_sarray.cpp
    action_class_set_darray.cpp
    action_class_set_iarray.cpp
    action_class_noop.cpp
    action_class_write.cpp
    action_class_print.cpp
    action_class_close.cpp
    action_class_variable.cpp
    action_class_modify.cpp
    action_class_transient_darray.cpp
    eccodes.cpp
    grib_accessor.cpp
    grib_concept.cpp
    grib_hash_array.cpp
    grib_bufr_descriptor.cpp
    grib_bufr_descriptors_array.cpp
    grib_darray.cpp
    grib_sarray.cpp
    grib_oarray.cpp
    grib_vdarray.cpp
    grib_vsarray.cpp
    grib_iarray.cpp
    grib_viarray.cpp
    codes_memfs.cpp
    grib_accessor_class_array.cpp
    grib_accessor_class_assert.cpp
    grib_accessor_class_ascii.cpp
    grib_accessor_class_bit.cpp
    grib_accessor_class_bitmap.cpp
    grib_accessor_class_bits.cpp
    grib_accessor_class_bits_per_value.cpp
    grib_accessor_class_bufr_elements_table.cpp
    grib_accessor_class_bufr_data_array.cpp
    grib_accessor_class_bufr_data_element.cpp
    grib_accessor_class_bufr_group.cpp
    grib_accessor_class_bufr_string_values.cpp
    grib_accessor_class_pack_bufr_values.cpp
    grib_accessor_class_unpack_bufr_values.cpp
    grib_accessor_class_apply_operators.cpp
    grib_accessor_class_group.cpp
    grib_accessor_class_non_alpha.cpp
    grib_accessor_class_g1bitmap.cpp
    grib_accessor_class_g2bitmap.cpp
    grib_accessor_class_concept.cpp
    grib_accessor_class_hash_array.cpp
    grib_accessor_class_decimal_precision.cpp
    grib_accessor_class_divdouble.cpp
    grib_accessor_class_budgdate.cpp
    grib_accessor_class_validity_date.cpp
    grib_accessor_class_validity_time.cpp
    grib_accessor_class_bytes.cpp
    grib_accessor_class.cpp
    grib_accessor_class_change_alternative_row_scanning.cpp
    grib_accessor_class_change_scanning_direction.cpp
    grib_accessor_class_check_internal_version.cpp
    grib_accessor_class_codeflag.cpp
    grib_accessor_class_smart_table.cpp
    grib_accessor_class_smart_table_column.cpp
    grib_accessor_class_codetable.cpp
    grib_accessor_class_codetable_units.cpp
    grib_accessor_class_codetable_title.cpp
    grib_accessor_class_step_human_readable.cpp
    grib_accessor_class_count_file.cpp
    grib_accessor_class_count_total.cpp
    grib_accessor_class_double.cpp
    grib_accessor_class_element.cpp
    grib_accessor_class_evaluate.cpp
    grib_accessor_class_g1area.cpp
    grib_accessor_class_g1date.cpp
    grib_accessor_class_g1monthlydate.cpp
    grib_accessor_class_library_version.cpp
    grib_accessor_class_when.cpp
    grib_accessor_class_g1verificationdate.cpp
    grib_accessor_class_g1day_of_the_year_date.cpp
    grib_accessor_class_g1_half_byte_codeflag.cpp
    grib_accessor_class_g1forecastmonth.cpp
    grib_accessor_class_g1step_range.cpp
    grib_accessor_class_g2step_range.cpp
    grib_accessor_class_data_g22order_packing.cpp
    grib_accessor_class_mars_step.cpp
    grib_accessor_class_message_copy.cpp
    grib_accessor_class_dictionary.cpp
    grib_accessor_class_latlon_increment.cpp
    grib_accessor_class_g2date.cpp
    grib_accessor_class_g2level.cpp
    grib_accessor_class_g2end_step.cpp
    grib_accessor_class_g2latlon.cpp
    grib_accessor_class_g2lon.cpp
    grib_accessor_class_global_gaussian.cpp
    grib_accessor_class_gaussian_grid_name.cpp
    grib_accessor_class_gen.cpp
    grib_accessor_class_getenv.cpp
    grib_accessor_class_gts_header.cpp
    grib_accessor_class_ifs_param.cpp
    grib_accessor_class_julian_day.cpp
    grib_accessor_class_julian_date.cpp
    grib_accessor_class_closest_date.cpp
    grib_accessor_class_latlonvalues.cpp
    grib_accessor_class_latitudes.cpp
    grib_accessor_class_longitudes.cpp
    grib_accessor_class_missing.cpp
    grib_accessor_class_offset_file.cpp
    grib_accessor_class_scale.cpp
    grib_accessor_class_from_scale_factor_scaled_value.cpp
    grib_accessor_class_times.cpp
    grib_accessor_class_forward.cpp
    grib_accessor_class_g2bitmap_present.cpp
    grib_accessor_class_ibmfloat.cpp
    grib_accessor_class_ieeefloat.cpp
    grib_accessor_class_constant.cpp
    grib_accessor_class_iterator.cpp
    grib_accessor_class_message.cpp
    grib_accessor_class_nearest.cpp
    grib_accessor_class_box.cpp
    grib_accessor_class_ksec1expver.cpp
    grib_accessor_class_laplacian.cpp
    grib_accessor_class_label.cpp
    grib_accessor_class_long.cpp
    grib_accessor_class_lookup.cpp
    grib_accessor_class_octahedral_gaussian.cpp
    grib_accessor_class_octet_number.cpp
    grib_accessor_class_headers_only.cpp
    grib_accessor_class_padding.cpp
    grib_accessor_class_pad.cpp
    grib_accessor_class_padto.cpp
    grib_accessor_class_padtoeven.cpp
    grib_accessor_class_padtomultiple.cpp
    grib_accessor_class_section_padding.cpp
    grib_accessor_class_section_pointer.cpp
    grib_accessor_class_position.cpp
    grib_accessor_class_signed.cpp
    grib_accessor_class_signed_bits.cpp
    grib_accessor_class_section.cpp
    grib_accessor_class_step_in_units.cpp
    grib_accessor_class_section_length.cpp
    grib_accessor_class_g1_message_length.cpp
    grib_accessor_class_g1_section4_length.cpp
    grib_accessor_class_size.cpp
    grib_accessor_class_rdbtime_guess_date.cpp
    grib_accessor_class_scale_values.cpp
    grib_accessor_class_offset_values.cpp
    grib_accessor_class_sprintf.cpp
    grib_accessor_class_round.cpp
    grib_accessor_class_spectral_truncation.cpp
    grib_accessor_class_time.cpp
    grib_accessor_class_transient.cpp
    grib_accessor_class_trim.cpp
    grib_accessor_class_transient_darray.cpp
    grib_accessor_class_values.cpp
    grib_accessor_class_simple_packing_error.cpp
    grib_accessor_class_data_simple_packing.cpp
    grib_accessor_class_count_missing.cpp
    grib_accessor_class_data_sh_packed.cpp
    grib_accessor_class_data_sh_unpacked.cpp
    grib_accessor_class_number_of_values_data_raw_packing.cpp
    grib_accessor_class_data_g1simple_packing.cpp
    grib_accessor_class_data_g1shsimple_packing.cpp
    grib_accessor_class_data_shsimple_packing.cpp
    grib_accessor_class_data_dummy_field.cpp
    grib_2order_packer_simple.cpp
    grib_accessor_class_variable.cpp
    grib_accessor_class_second_order_bits_per_value.cpp
    grib_accessor_class_data_g2simple_packing.cpp
    grib_accessor_class_data_g2simple_packing_with_preprocessing.cpp
    grib_accessor_class_data_g2shsimple_packing.cpp
    grib_accessor_class_data_g2complex_packing.cpp
    grib_accessor_class_data_2order_packing.cpp
    grib_accessor_class_data_g1second_order_row_by_row_packing.cpp
    grib_accessor_class_data_g1second_order_constant_width_packing.cpp
    grib_accessor_class_data_g1second_order_general_packing.cpp
    grib_accessor_class_data_g1second_order_general_extended_packing.cpp
    grib_accessor_class_g2grid.cpp
    grib_accessor_class_unexpanded_descriptors.cpp
    grib_accessor_class_expanded_descriptors.cpp
    grib_accessor_class_bufrdc_expanded_descriptors.cpp
    grib_accessor_class_data_apply_bitmap.cpp
    grib_accessor_class_data_apply_boustrophedonic.cpp
    grib_accessor_class_data_apply_boustrophedonic_bitmap.cpp
    grib_accessor_class_data_secondary_bitmap.cpp
    grib_accessor_class_data_g1secondary_bitmap.cpp
    grib_accessor_class_data_g2secondary_bitmap.cpp
    grib_accessor_class_data_jpeg2000_packing.cpp
    grib_accessor_class_data_png_packing.cpp
    grib_accessor_class_data_ccsds_packing.cpp
    grib_accessor_class_data_raw_packing.cpp
    grib_accessor_class_data_complex_packing.cpp
    grib_accessor_class_data_g1complex_packing.cpp
    grib_accessor_class_gds_not_present_bitmap.cpp
    grib_accessor_class_data_apply_gdsnotpresent.cpp
    grib_accessor_class_gds_is_present.cpp
    grib_accessor_class_select_step_template.cpp
    grib_accessor_class_local_definition.cpp
    grib_accessor_class_g2_eps.cpp
    grib_accessor_class_g2_aerosol.cpp
    grib_accessor_class_g2_chemical.cpp
    grib_accessor_class_g2_mars_labeling.cpp
    grib_accessor_class_md5.cpp
    grib_accessor_class_proj_string.cpp
    grib_jasper_encoding.cpp
    grib_openjpeg_encoding.cpp
    action_class_set_missing.cpp
    grib_accessor_class_number_of_points.cpp
    grib_accessor_class_suppressed.cpp
    grib_index.cpp
    grib_accessor_class_number_of_points_gaussian.cpp
    grib_accessor_class_number_of_values.cpp
    grib_accessor_class_number_of_coded_values.cpp
    grib_accessor_class_g1number_of_coded_values_sh_complex.cpp
    grib_accessor_class_g1number_of_coded_values_sh_simple.cpp
    grib_accessor_class_dirty.cpp
    grib_accessor_class_statistics.cpp
    grib_accessor_class_statistics_spectral.cpp
    grib_accessor_class_unsigned.cpp
    grib_accessor_class_unsigned_bits.cpp
    grib_accessor_class_raw.cpp
    grib_accessor_class_bufr_simple_thinning.cpp
    grib_accessor_class_bufr_extract_subsets.cpp
    grib_accessor_class_bufr_extract_area_subsets.cpp
    grib_accessor_class_bufr_extract_datetime_subsets.cpp
    grib_accessor_class_spd.cpp
    grib_accessor_class_sum.cpp
    grib_accessor_class_to_integer.cpp
    grib_accessor_class_to_double.cpp
    grib_accessor_class_to_string.cpp
    grib_accessor_class_sexagesimal2decimal.cpp
    grib_accessor_class_vector.cpp
    grib_accessor_class_long_vector.cpp
    grib_gaussian_reduced.cpp
    grib_accessor_class_abstract_vector.cpp
    grib_accessor_class_abstract_long_vector.cpp
    grib_loader_from_handle.cpp
    grib_bits.cpp
    grib_timer.cpp
    grib_ibmfloat.cpp
    grib_ieeefloat.cpp
    grib_accessor_class_reference_value_error.cpp
    grib_memory.cpp
    grib_buffer.cpp
    grib_dumper.cpp
    grib_dumper_class_serialize.cpp
    grib_dumper_class_debug.cpp
    grib_dumper_class_default.cpp
    grib_dumper_class_keys.cpp
    grib_dumper_class_bufr_encode_C.cpp
    grib_dumper_class_bufr_encode_filter.cpp
    grib_dumper_class_bufr_encode_fortran.cpp
    grib_dumper_class_bufr_encode_python.cpp
    grib_dumper_class_bufr_decode_C.cpp
    grib_dumper_class_bufr_decode_filter.cpp
    grib_dumper_class_bufr_decode_fortran.cpp
    grib_dumper_class_bufr_decode_python.cpp
    grib_dumper_class_bufr_simple.cpp
    grib_dumper_class_json.cpp
    grib_dumper_class_grib_encode_C.cpp
    grib_dumper_class_wmo.cpp
    grib_dumper_class.cpp
    grib_context.cpp
    grib_date.cpp
    grib_fieldset.cpp
    grib_filepool.cpp
    grib_geography.cpp
    grib_handle.cpp
    grib_header_compute.cpp
    grib_hash_keys.cpp
    grib_io.cpp
    grib_trie.cpp
    grib_trie_with_rank.cpp
    grib_itrie.cpp
    grib_rules.cpp
    grib_keys_iterator.cpp
    bufr_keys_iterator.cpp
    grib_parse_utils.cpp
    grib_query.cpp
    grib_scaling.cpp
    grib_templates.cpp
    grib_dependency.cpp
    grib_value.cpp
    grib_errors.cpp
    grib_expression_class_binop.cpp
    grib_expression_class_logical_and.cpp
    grib_expression_class_logical_or.cpp
    grib_expression_class_is_in_dict.cpp
    grib_expression_class_true.cpp
    grib_expression_class_string_compare.cpp
    grib_expression_class_unop.cpp
    grib_expression_class_functor.cpp
    grib_expression_class_accessor.cpp
    grib_expression_class_is_in_list.cpp
    grib_expression_class_is_integer.cpp
    grib_expression_class_length.cpp
    grib_expression_class_long.cpp
    grib_expression_class_double.cpp
    grib_expression_class_string.cpp
    grib_expression_class_sub_string.cpp
    grib_box.cpp
    grib_box_class.cpp
    grib_box_class_gen.cpp
    grib_nearest.cpp
    grib_nearest_class.cpp
    grib_nearest_class_gen.cpp
    grib_nearest_class_regular.cpp
    grib_nearest_class_reduced.cpp
    grib_nearest_class_latlon_reduced.cpp
    grib_nearest_class_sh.cpp
    grib_nearest_class_lambert_conformal.cpp
    grib_nearest_class_lambert_azimuthal_equal_area.cpp
    grib_nearest_class_mercator.cpp
    grib_nearest_class_polar_stereographic.cpp
    grib_nearest_class_space_view.cpp
    grib_iterator_class_polar_stereographic.cpp
    grib_iterator_class_lambert_azimuthal_equal_area.cpp
    grib_iterator_class_lambert_conformal.cpp
    grib_iterator_class_mercator.cpp
    grib_iterator.cpp
    grib_iterator_class.cpp
    grib_iterator_class_gaussian.cpp
    grib_iterator_class_gaussian_reduced.cpp
    grib_iterator_class_latlon_reduced.cpp
    grib_iterator_class_gen.cpp
    grib_iterator_class_latlon.cpp
    grib_iterator_class_regular.cpp
    grib_iterator_class_space_view.cpp
    grib_expression.cpp
    codes_util.cpp
    grib_util.cpp
    bufr_util.cpp
    string_util.cpp
    functions.cpp
    grib_accessor_class.h
    grib_accessor_factory.h
    grib_api_internal.h
    eccodes_prototypes.h
    grib_box_class.h
    grib_box_factory.h
    grib_dumper_class.h
    grib_dumper_factory.h
    grib_emoslib.h
    grib_iterator_class.h
    grib_iterator_factory.h
    grib_nearest_class.h
    grib_nearest_factory.h
    grib_yacc.h
    md5.h
    md5.cpp
    grib_accessor_class_int16.cpp
    grib_accessor_class_int16_little_endian.cpp
    grib_accessor_class_int32.cpp
    grib_accessor_class_int32_little_endian.cpp
    grib_accessor_class_int64.cpp
    grib_accessor_class_int64_little_endian.cpp
    grib_accessor_class_int8.cpp
    grib_accessor_class_uint16.cpp
    grib_accessor_class_uint16_little_endian.cpp
    grib_accessor_class_uint32.cpp
    grib_accessor_class_uint32_little_endian.cpp
    grib_accessor_class_uint64.cpp
    grib_accessor_class_uint64_little_endian.cpp
    grib_accessor_class_uint8.cpp
    grib_accessor_class_blob.cpp
    grib_optimize_decimal_factor.cpp
    grib_accessor_class_data_g2bifourier_packing.cpp
    grib_accessor_class_data_run_length_packing.cpp
    eccodes_windef.h
    # We ship our own generated lex/yacc C files
    grib_yacc.cpp  grib_lex.cpp )

list( APPEND eccodes_extra_src_files
    grib_bits_fast_big_endian.cpp grib_bits_any_endian.cpp
    grib_bits_fast_big_endian_vector.cpp grib_bits_any_endian_vector.cpp
    grib_bits_fast_big_endian_simple.cpp grib_bits_any_endian_simple.cpp
    grib_bits_fast_big_endian_omp.cpp grib_bits_any_endian_omp.cpp
    encode_double_array.cpp
    grib_bits_ibmpow.cpp
    grib_bits_ibmpow_opt.cpp
    minmax_val.cpp )

if(UNIX)
    ecbuild_get_date(eccodes_BUILD_DATE)
endif()
configure_file( grib_api_version.cpp.in grib_api_version.cpp @ONLY )
configure_file( eccodes_version.h.in eccodes_version.h @ONLY )

# We ship our own generated lex/yacc C files
#ecbuild_generate_yy(YYPREFIX  grib_yy
#                    YACC      griby
#                    LEX       gribl
#                    FLEX_FLAGS " "
#                    LEX_FLAGS  " "
#                    BISON_FLAGS "-y"
#                    YACC_FLAGS  "-y"
#                    DEPENDANT action.cpp )

if( HAVE_MEMFS )
    list(APPEND ECCODES_EXTRA_LIBRARIES eccodes_memfs)
endif()

ecbuild_add_library( TARGET    eccodes
                     SOURCES   ${CMAKE_CURRENT_BINARY_DIR}/grib_api_version.cpp
                              # griby.cpp gribl.cpp
                              ${eccodes_src_files}
                     #PRIVATE_LIBS      ${ECCODES_EXTRA_LIBRARIES} ${CMAKE_THREAD_LIBS_INIT} ${CMATH_LIBRARIES}
                     PRIVATE_INCLUDES "${AEC_INCLUDE_DIRS}" "${PNG_INCLUDE_DIRS}"
                     PRIVATE_LIBS ${ECCODES_EXTRA_LIBRARIES} ${CMAKE_THREAD_LIBS_INIT} ${AEC_LIBRARIES} ${PNG_LIBRARIES}
                     PUBLIC_LIBS  ${CMATH_LIBRARIES} ${THREADS_LIBRARIES}
                     TEMPLATES ${eccodes_extra_src_files}
                     INSTALL_HEADERS_LIST
                              grib_api.h
                              eccodes.h
                              eccodes_windef.h
                              ${CMAKE_CURRENT_BINARY_DIR}/eccodes_version.h
                              ${PROJECT_BINARY_DIR}/eccodes_config.h
                    PUBLIC_INCLUDES
                              $<BUILD_INTERFACE:${PROJECT_BINARY_DIR}/src>
                              $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/src> )
